#!/usr/bin/env bash
# https://vaneyckt.io/posts/safer_bash_scripts_with_set_euxo_pipefail
set -Eeuo pipefail

gitlog_cmd="git log --color=always --pretty=format:'%Cred%h %C(reset)%C(dim)%ad%Creset %C(blue)%an%Creset %s%C(yellow)%d%C(reset) %Cgreen(%ar)%Creset' --abbrev-commit --date-order --date='format:%F %R'"

bash -c "$gitlog_cmd" \
  | fzf --no-sort --exact --ansi --height 90% --reverse \
  --preview "git name-rev --name-only --no-undefined --always \$(echo {} | cut -d ' ' -f1) && git show \$(echo {} | cut -d ' ' -f1) --stat --format=reference --color=always && git show --color-words \$(echo {} | cut -d ' ' -f1)" \
  --bind "ctrl-d:preview-page-down,ctrl-u:preview-page-up,ctrl-a:reload($gitlog_cmd --all)" \
  | cut -d ' ' -f1 | tr '\n' ' '

#  | xargs git name-rev --name-only --no-undefined --always
